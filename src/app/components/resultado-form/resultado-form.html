<div class="resultform-wrapper">
  <h2 class="resultform-title">{{ isEdit ? 'Editar Resultado' : 'Nuevo Resultado' }}</h2>

  <p *ngIf="loading" class="muted">Cargando...</p>

  <div *ngIf="errorMsg" class="alert-error">
    {{ errorMsg }}
  </div>

  <form [formGroup]="form" (ngSubmit)="guardar()" *ngIf="!loading" class="resultform-card">

    <div class="resultform-row">
      <div class="form-group">
        <label class="form-label">Laboratorio ID <span class="required">*</span></label>
        <input type="number" formControlName="laboratorioId" placeholder="Ej: 1" class="form-input" />
        <small class="form-error" *ngIf="hasError('laboratorioId','required')">laboratorioId es obligatorio</small>
        <small class="form-error" *ngIf="hasError('laboratorioId','min')">laboratorioId debe ser mayor que 0</small>
      </div>

      <div class="form-group">
        <label class="form-label">Analista ID <span class="required">*</span></label>
        <input type="number" formControlName="analistaId" placeholder="Ej: 10" class="form-input" />
        <small class="form-error" *ngIf="hasError('analistaId','required')">analistaId es obligatorio</small>
        <small class="form-error" *ngIf="hasError('analistaId','min')">analistaId debe ser mayor que 0</small>
      </div>
    </div>

    <div class="resultform-row">
      <div class="form-group">
        <label class="form-label">Fecha Muestra</label>
        <input type="date" formControlName="fechaMuestra" class="form-input" />
      </div>

      <div class="form-group">
        <label class="form-label">Fecha Resultado <span class="required">*</span></label>
        <input type="date" formControlName="fechaResultado" class="form-input" />
        <small class="form-error" *ngIf="hasError('fechaResultado','required')">fecha es obligatoria</small>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Estado <span class="required">*</span></label>
      <select formControlName="estado" class="form-input">
        <option value="">Selecciona un estado</option>
        <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
      </select>
      <small class="form-error" *ngIf="hasError('estado','required')">estado es obligatorio</small>
    </div>

    <div class="form-group">
      <label class="form-label">Observación <span class="hint">(máx 500)</span></label>
      <textarea rows="4" formControlName="observacion" placeholder="Observación..." class="form-input"></textarea>
      <small class="form-error" *ngIf="hasError('observacion','maxlength')">No puede superar 500 caracteres</small>
    </div>

    <div class="resultform-buttons">
      <button type="submit" class="btn btn-primary" [disabled]="saving">
        {{ saving ? 'Guardando...' : (isEdit ? 'Actualizar' : 'Crear') }}
      </button>

      <button type="button" class="btn btn-ghost" (click)="cancelar()" [disabled]="saving">Cancelar</button>

      <a routerLink="/resultados" class="btn btn-ghost" style="text-decoration: none;">Volver al listado</a>
    </div>
  </form>
</div>
